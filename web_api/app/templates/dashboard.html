{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem;">Dashboard</h1>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 10px;">
        <h3 style="margin-bottom: 0.5rem;">Welcome back!</h3>
        <p>{{ current_user.name }}</p>
        <p style="font-size: 0.9rem; opacity: 0.9;">{{ current_user.email }}</p>
    </div>
    
    <div style="background: #f8f9fa; padding: 2rem; border-radius: 10px;">
        <h3 style="margin-bottom: 0.5rem; color: #667eea;">Account Status</h3>
        {% if current_user.is_admin %}
        <p><span class="badge badge-admin">Administrator</span></p>
        <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">You have full access to manage users and requests</p>
        {% elif current_user.is_pending_admin %}
        <p><span class="badge badge-pending">Admin Request Pending</span></p>
        <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">Your request is being reviewed</p>
        {% else %}
        <p>Standard User</p>
        <form method="POST" action="{{ url_for('admin.create_request') }}" style="margin-top: 1rem;">
            <button type="submit" class="btn btn-primary">Request Admin Access</button>
        </form>
        {% endif %}
    </div>
    
    <div style="background: #f8f9fa; padding: 2rem; border-radius: 10px;">
        <h3 style="margin-bottom: 0.5rem; color: #667eea;">Member Since</h3>
        <p>{{ current_user.created_at.strftime('%B %d, %Y') }}</p>
        <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">Last login: {{ current_user.last_login.strftime('%B %d, %Y at %I:%M %p') }}</p>
    </div>
</div>

{% if current_user.is_admin and pending_requests %}
<div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #ffc107; margin-bottom: 2rem;">
    <h3 style="color: #856404; margin-bottom: 1rem;">âš ï¸ Pending Admin Requests</h3>
    <p style="color: #856404; margin-bottom: 1rem;">You have {{ pending_requests|length }} pending admin request(s) to review</p>
    <a href="{{ url_for('admin.requests') }}" class="btn btn-primary">Review Requests</a>
</div>
{% endif %}

{% if pending_queries %}
<div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #ffc107; margin-bottom: 2rem;">
    <h3 style="color: #856404; margin-bottom: 1rem;">â³ Queries Awaiting Your Approval</h3>
    <p style="color: #856404; margin-bottom: 1rem;">{{ pending_queries|length }} quer{{ 'y' if pending_queries|length == 1 else 'ies' }} need{{ '' if pending_queries|length == 1 else '' }} your review</p>
    <div style="display: grid; gap: 1rem; margin-bottom: 1rem;">
        {% for query in pending_queries[:3] %}
        <div style="background: white; padding: 1rem; border-radius: 5px;">
            <strong style="color: #667eea;">{{ query.name }}</strong>
            <p style="color: #666; font-size: 0.85rem; margin: 0.25rem 0;">{{ query.session.name }}</p>
            <a href="{{ url_for('tee_web.query_detail', query_id=query.id) }}" style="color: #667eea; font-size: 0.85rem; text-decoration: none;">Review Query â†’</a>
        </div>
        {% endfor %}
    </div>
    <a href="{{ url_for('tee_web.sessions') }}" class="btn btn-primary">View All Sessions</a>
</div>
{% endif %}

{% if user_sessions %}
<div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
    <h3 style="color: #667eea; margin-bottom: 1rem;">ğŸ“Š Your Collaboration Sessions</h3>
    <div style="display: grid; gap: 1rem;">
        {% for session in user_sessions %}
        <div style="background: white; padding: 1rem; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <strong style="color: #667eea;">{{ session.name }}</strong>
                <p style="color: #666; font-size: 0.85rem; margin: 0.25rem 0;">
                    {{ session.participants|length }} participants Â· {{ session.queries.count() }} queries
                </p>
            </div>
            <a href="{{ url_for('tee_web.session_detail', session_id=session.id) }}" class="btn btn-secondary" style="padding: 0.5rem 1rem;">View</a>
        </div>
        {% endfor %}
    </div>
    <a href="{{ url_for('tee_web.sessions') }}" style="color: #667eea; text-decoration: none; display: inline-block; margin-top: 1rem;">View all sessions â†’</a>
</div>
{% endif %}

<div style="background: #e7f3ff; padding: 2rem; border-radius: 10px; margin-top: 2rem;">
    <h3 style="color: #667eea; margin-bottom: 1rem;">Quick Actions</h3>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('tee_web.sessions') }}" class="btn btn-primary">ğŸ¤ Collaborations</a>
        <a href="{{ url_for('tee_web.create_session') }}" class="btn btn-primary">+ New Session</a>
        <a href="{{ url_for('datasets_web.list_datasets') }}" class="btn btn-primary">ğŸ“‚ My Datasets</a>
        <a href="{{ url_for('datasets_web.upload_dataset') }}" class="btn btn-primary">â¬†ï¸ Upload Dataset</a>
        <a href="{{ url_for('api_keys.list_keys') }}" class="btn btn-secondary">ğŸ”‘ API Keys</a>
        {% if current_user.is_admin %}
        <a href="{{ url_for('admin.users') }}" class="btn btn-secondary">Manage Users</a>
        <a href="{{ url_for('admin.requests') }}" class="btn btn-secondary">Admin Requests</a>
        {% endif %}
        <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">Logout</a>
    </div>
</div>
{% endblock %}
